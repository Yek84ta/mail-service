# مستندات پکیج مدیریت ایمیل (Mail Package)

## معرفی

پکیج مدیریت ایمیل بخش اصلی سرویس میل (Milo) است که تمامی عملیات مرتبط با ارسال، دریافت و مدیریت ایمیل‌ها را پیاده‌سازی می‌کند.

## ساختار پکیج

```
aut.ap.mail/
├── Mail.java          - موجودیت اصلی ایمیل
├── MailDto.java       - مدل انتقال داده ایمیل
├── MailRepository.java - لایه دسترسی به داده‌های ایمیل
├── MailService.java   - لایه سرویس و منطق کسب و کار
└── MailValidation.java - اعتبارسنجی‌های مربوط به ایمیل
```

## اجزای اصلی

### 1. موجودیت Mail (`Mail.java`)

کلاس اصلی نماینده یک ایمیل در سیستم با ویژگی‌های:

- **شناسه یکتا** و کد منحصر به فرد
- **فرستنده** (ارتباط ManyToOne با User)
- **گیرندگان** (ارتباط ManyToMany با User)
- **موضوع** و محتوای ایمیل
- **تاریخ ارسال**
- **وضعیت حذف شدن** و زمان حذف
- متدهای کمکی برای مدیریت چرخه زندگی ایمیل

### 2. مدل انتقال داده (`MailDto.java`)

نمایش ساده‌شده ایمیل برای انتقال بین لایه‌ها با:

- اطلاعات ضروری ایمیل
- نام و ایمیل فرستنده
- وضعیت خوانده شدن/حذف شدن
- الگوی Builder برای ساخت آسان

### 3. لایه دسترسی به داده‌ها (`MailRepository.java`)

مسئول تعامل با پایگاه داده و ارائه متدهای:

- ذخیره و بازیابی ایمیل‌ها
- مدیریت وضعیت خوانده شدن
- جستجو در صندوق ورودی، ارسال‌ها و سطل زباله
- عملیات انتقال به سطل زباله و بازیابی

### 4. لایه سرویس (`MailService.java`)

ارائه دهنده سرویس‌های اصلی با قابلیت‌های:

- **ارسال ایمیل** جدید
- **دریافت ایمیل‌ها** (صندوق ورودی، ارسال‌ها، خوانده نشده‌ها)
- **پاسخ** به ایمیل‌ها
- **ارجاع** ایمیل‌ها
- مدیریت **سطل زباله**
- تبدیل موجودیت به DTO

### 5. اعتبارسنجی‌ها (`MailValidation.java`)

اعتبارسنجی‌های ضروری برای:

- موضوع ایمیل (عدم خالی بودن و طول مناسب)
- محتوای ایمیل (عدم خالی بودن و حجم مناسب)
- گیرندگان ایمیل (وجود حداقل یک گیرنده معتبر)
- جلوگیری از ارسال به خود
;
```
## ویژگی‌های کلیدی

- **مدیریت جامع چرخه زندگی ایمیل** از ایجاد تا حذف
- **تفکیک دسترسی** برای فرستنده و گیرندگان
- **پیگیری وضعیت خوانده شدن** ایمیل‌ها
- **مدیریت سطل زباله** با امکان بازیابی
- **الگوی طراحی Builder** برای ساخت آسان DTOها
- **اعتبارسنجی‌های امنیتی** برای تمام عملیات
- **مدیریت تراکنش‌ها** برای حفظ یکپارچگی داده‌ها

